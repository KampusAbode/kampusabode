# Referral System Documentation

## Overview

The referral system allows admins to generate referral codes for specific users, track signups through those codes, and view comprehensive analytics about referral performance.

## Features

- **Admin Dashboard**: Generate and manage referral codes
- **User Signup Integration**: Users can enter referral codes during signup
- **Analytics**: Track referral performance and top referrers
- **Firebase Integration**: All data stored in Firestore collections

## Database Collections

### 1. `referralCodes`
Stores referral codes generated by admins.

**Fields:**
- `id`: Document ID
- `code`: Unique 8-character referral code
- `ownerId`: User ID who owns this referral code
- `ownerName`: Name of the code owner
- `ownerEmail`: Email of the code owner
- `createdAt`: Timestamp when code was created
- `expiresAt`: Optional expiration date
- `isActive`: Boolean indicating if code is active
- `usageCount`: Number of times code has been used
- `maxUsage`: Optional maximum usage limit
- `description`: Optional description
- `createdBy`: Admin who created the code

### 2. `referralRecords`
Stores records of users who signed up with referral codes.

**Fields:**
- `id`: Document ID
- `referralCodeId`: ID of the referral code used
- `referralCode`: The actual code string used
- `referrerId`: User ID who owns the referral code
- `referrerName`: Name of the referrer
- `referredUserId`: User ID who signed up with the code
- `referredUserName`: Name of the referred user
- `referredUserEmail`: Email of the referred user
- `signupDate`: Timestamp when signup occurred
- `status`: Status of the referral ('pending', 'completed', 'verified')
- `reward`: Optional reward information
- `notes`: Optional notes

## API Endpoints

### POST `/api/referrals/create-code`
Creates a new referral code for a user.

**Headers:**
- `Authorization: Bearer <token>`

**Body:**
```json
{
  "ownerId": "user_id",
  "ownerName": "User Name",
  "ownerEmail": "user@example.com",
  "maxUsage": 100,
  "expiresAt": "2024-12-31T23:59:59Z",
  "description": "Optional description"
}
```

### POST `/api/referrals/validate-code`
Validates a referral code.

**Body:**
```json
{
  "code": "ABC12345"
}
```

### POST `/api/referrals/create-record`
Creates a referral record when someone signs up with a code.

**Headers:**
- `Authorization: Bearer <token>`

**Body:**
```json
{
  "referralCodeId": "code_id",
  "referralCode": "ABC12345",
  "referrerId": "referrer_id",
  "referrerName": "Referrer Name",
  "referredUserId": "new_user_id",
  "referredUserName": "New User Name",
  "referredUserEmail": "newuser@example.com"
}
```

### GET `/api/referrals/stats`
Gets referral statistics.

**Headers:**
- `Authorization: Bearer <token>`

### GET `/api/referrals/codes`
Gets all referral codes.

**Headers:**
- `Authorization: Bearer <token>`

### GET `/api/referrals/records`
Gets all referral records.

**Headers:**
- `Authorization: Bearer <token>`

## Usage

### For Admins

1. **Access Admin Dashboard**: Navigate to `/admin?page=referrals`
2. **Create Referral Code**: 
   - Click "Create New Code"
   - Fill in owner details
   - Set optional limits and expiration
   - Generate code
3. **View Analytics**: 
   - Switch to "Statistics" tab
   - View conversion rates and top referrers
4. **Manage Codes**: 
   - View all codes and their usage
   - Deactivate codes if needed

### For Users

1. **Signup with Referral Code**:
   - During signup, enter referral code in the "Referral Code" field
   - System automatically validates and creates referral record
   - Signup continues normally even if referral code is invalid

## Components

### ReferralManagement
Main admin component for managing referral codes, records, and viewing statistics.

**Location**: `app/components/admin/ReferralManagement.tsx`

### ReferralOverview
Compact overview component showing key referral metrics.

**Location**: `app/components/admin/ReferralOverview.tsx`

## Utility Functions

### Core Functions (`app/utils/referrals.ts`)

- `generateReferralCode()`: Generates unique 8-character codes
- `createReferralCode()`: Creates new referral code in database
- `validateReferralCode()`: Validates code and checks limits
- `createReferralRecord()`: Creates referral record for signup
- `getReferralStats()`: Calculates referral statistics
- `getAllReferralCodes()`: Fetches all codes
- `getAllReferralRecords()`: Fetches all records

## Integration Points

### Signup Flow
The signup process automatically handles referral codes:
1. User enters referral code during signup
2. Code is validated against database
3. If valid, referral record is created
4. Signup continues regardless of referral status

### Admin Dashboard
Integrated into existing admin dashboard with new "referrals" tab.

## Security

- All admin endpoints require authentication
- Referral code validation prevents duplicate usage
- Expiration dates and usage limits are enforced
- Invalid codes don't block user signup

## Styling

Custom CSS styles are included in `app/components/admin/referral-management.css` for:
- Tab navigation
- Form styling
- Table layouts
- Statistics cards
- Responsive design

## Future Enhancements

Potential improvements:
- Email notifications for successful referrals
- Reward system integration
- Referral code sharing links
- Advanced analytics and reporting
- Bulk code generation
- Referral leaderboards
